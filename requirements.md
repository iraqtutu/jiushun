# 玖顺农机售后服务工单系统 - 需求规格说明书 (PRD) v1.3

## 1. 项目概述

### 1.1 项目背景
玖顺农机目前采用传统的纸质工单进行售后服务记录，存在数据录入繁琐、查询困难、不易统计和归档等问题。为了提高售后服务效率，实现数据的数字化管理，计划开发一套基于微信小程序的电子工单系统。

### 1.2 项目目标
- **无纸化办公**：将线下纸质填写流程完全迁移至线上。
- **数据规范化**：通过下拉菜单、必填项校验等手段，规范填写内容，减少错误。
- **提升效率**：自动生成单号，支持图片上传和自动识别，减少人工录入成本。
- **追溯与管理**：实现工单的数字化存储，便于后续查询、审核。
- **灵活授权**：支持用户自主申请账号，管理员审核，减轻初始录入工作量。

### 1.3 技术平台
- **前端**：UniApp (发布为微信小程序)
- **后端**：uniCloud (阿里云)

---

## 2. 用户角色与权限

| 角色 | 描述 | 核心权限 |
| :--- | :--- | :--- |
| **系统管理员 (admin)** | 最高权限管理者 | 登录、查看所有工单、**审批账号申请** |
| **玖顺员工** | 厂家内部技术人员 | 登录、新建工单、查看所有/指定工单 (无审批权) |
| **经销商人员** | 代理销售及服务的合作伙伴 | 登录、新建工单、查看自己提交的工单 |
| **服务人员** | 一线维修与售后人员 | 登录、新建工单、查看自己提交的工单 |
| **待审核用户** | 已提交申请但未获批的用户 | 仅能查看申请状态或重新提交 |

---

## 3. 功能需求详情

### 3.1 用户登录系统
- **登录方式**：**微信一键登录** (利用 OpenID 自动识别)。
- **权限校验流程**：
  1. 用户进入小程序，自动或点击按钮发起“微信登录”。
  2. 系统获取微信身份 (OpenID)。
  3. **后端校验**：
     - 若用户为新 OpenID，创建“临时用户”。
     - 检查该用户是否拥有有效角色（admin/玖顺员工/经销商人员/服务人员）。
  4. **判定结果**：
     - **已授权**：直接进入系统首页。
     - **未授权**：
       - 若无申请记录：跳转至“权限申请页”。
       - 若有审核中记录：提示“审核中”。
       - 若被拒绝：提示拒绝原因并允许重新申请。

### 3.2 账号申请与审批

#### 3.2.1 账号申请 (前端)
无权限用户可进入申请页面，提交以下信息：
- **姓名**：必填，文本。
- **手机号**：必填，数字。
- **用户类型**：必填，下拉选择（玖顺员工 / 经销商人员 / 服务人员）。
- **申请理由**：必填，多行文本。

#### 3.2.2 账号审批 (管理员功能)
**仅限拥有 `admin` 角色的用户访问。**
- **待办列表**：展示所有状态为“待审核”的申请记录。
- **审批操作**：
  - **通过**：更新用户表 (`uni-id-users`) 的 Role、Mobile、Nickname，随后更新申请单状态。若手机号已存在，提示冲突错误。
  - **拒绝**：需填写拒绝理由，更新申请单状态为“已拒绝”。

### 3.3 派工单管理 (核心业务)

#### 3.3.1 新建派工单
用户点击“新建工单”进入填写页面。

**A. 基础信息**
- **派工单号**：系统自动生成 (例如 `JS202601150001`)。
- **填单人**：自动读取当前登录用户姓名。

**B. 资料录入 (客户/产品/服务)**
- 包含客户资料、产品信息、服务内容等详细字段。
- **更换零件信息**：需包含 零件名称、图号、数量、旧件处理方式（带回/丢弃）。
- **服务信息**：需包含 **维修完成时间**（精确到分钟）。
- **现场照片**：
  - 数量限制：最少 1 张。
  - **逻辑校验**：照片数量不得少于更换零件的数量（例如更换 3 个零件，需至少上传 3 张照片）。
- **日期处理**：前端选择日期后，后端统一转换为**时间戳**存储。

**C. 图片管理**
- **文件夹结构**：所有上传的图片（铭牌、现场照片、人机合影）均存储在以**工单号**命名的云存储文件夹中（例如 `JS202601150001/timestamp.jpg`）。
- **流程**：点击提交时，先自动上传所有本地图片至云存储，获取 Cloud ID 后再提交表单数据。

**D. 草稿自动保存**
- **自动缓存**：用户填写过程中实时缓存至本地 Storage。
- **断点续传**：再次进入时提示恢复草稿。提交成功后自动清除。

#### 3.3.2 我的工单
- **列表展示**：
  - **普通用户**：仅展示自己创建的工单。
  - **管理员/员工**：可查看所有工单 (根据后续需求调整，目前默认看自己的，管理员接口层面有权看所有)。
- **详情查看**：展示完整工单信息及图片。

---

## 4. 非功能性需求

- **易用性**：界面简洁，大按钮设计。
- **性能**：图片需压缩上传，列表分页加载。
- **稳定性**：弱网下提交需有Loading提示。

---

## 5. 待确认事项
1. **自动识别技术**：OCR 接口待接入。

---