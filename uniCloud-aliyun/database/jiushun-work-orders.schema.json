{
	"bsonType": "object",
	"required": ["orderNo", "customerInfo", "productInfo", "serviceInfo", "customerConfirm"],
	"permission": {
		"read": "doc.creator_uid == auth.uid || 'admin' in auth.role",
		"create": "auth.uid != null",
		"update": "false",
		"delete": "false"
	},
	"properties": {
		"_id": {
			"description": "ID，系统自动生成",
			"bsonType": "string"
		},
		"orderNo": {
			"description": "派工单号",
			"bsonType": "string"
		},
		"creator_uid": {
			"description": "填单人ID",
			"bsonType": "string",
			"foreignKey": "uni-id-users._id"
		},
		"customerInfo": {
			"bsonType": "object",
			"description": "客户资料",
			"required": ["name", "phone", "address", "usageType"],
			"properties": {
				"name": { "bsonType": "string", "description": "客户姓名" },
				"phone": { "bsonType": "string", "description": "联系电话" },
				"address": { "bsonType": "string", "description": "地址" },
				"usageType": { 
					"bsonType": "string", 
					"enum": ["自用", "作业"],
					"description": "农机用途" 
				},
				"distributorName": { "bsonType": "string", "description": "经销商名称" },
				"reportTime": { "bsonType": "timestamp", "description": "报修时间" }
			}
		},
		"productInfo": {
			"bsonType": "object",
			"description": "产品信息",
			"required": ["machineNo", "engineNo", "platePhoto", "productionDate", "model"],
			"properties": {
				"machineNo": { "bsonType": "string", "description": "机器编号" },
				"engineNo": { "bsonType": "string", "description": "发动机号" },
				"platePhoto": { "bsonType": "file", "description": "铭牌照片FileID" },
				"productionDate": { "bsonType": "timestamp", "description": "生产日期" },
				"model": { "bsonType": "string", "description": "产品型号" }
			}
		},
		"serviceInfo": {
			"bsonType": "object",
			"description": "服务内容",
			"required": ["type", "faultCategory", "faultDesc", "handleDesc"],
			"properties": {
				"type": { 
					"bsonType": "string", 
					"enum": ["三包", "维修", "保养", "技改", "其他"],
					"description": "服务类型" 
				},
				"faultCategory": { 
					"bsonType": "string",
					"enum": ["发动机", "液压系统", "行走传动系统", "电气系统", "插值系统", "其他"],
					"description": "故障信息分类"
				},
				"faultDesc": { "bsonType": "string", "description": "故障现象" },
				"handleDesc": { "bsonType": "string", "description": "处理方法" },
				"parts": {
					"bsonType": "array",
					"description": "更换零件列表",
					"items": {
						"bsonType": "object",
						"properties": {
							"name": { "bsonType": "string", "description": "零件名称" },
							"code": { "bsonType": "string", "description": "图号" },
							"count": { "bsonType": "int", "description": "数量" }
						}
					}
				},
				"oldPartAction": { 
					"bsonType": "string", 
					"enum": ["带回", "丢弃"],
					"description": "旧件处理方式"
				},
				"finishTime": { "bsonType": "timestamp", "description": "维修完成时间" },
				"sitePhotos": { 
					"bsonType": "array", 
					"description": "现场照片列表",
					"items": { "bsonType": "file" }
				}
			}
		},
		"customerConfirm": {
			"bsonType": "object",
			"description": "客户确认",
			"required": ["machineUserPhoto"],
			"properties": {
				"machineUserPhoto": { "bsonType": "file", "description": "人机合影" }
			}
		},
		"create_date": { "bsonType": "timestamp" }
	}
}